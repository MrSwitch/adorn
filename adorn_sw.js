(()=>{var l=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var b=(r,e)=>()=>(r&&(e=r(r=0)),e);var v=(r,e)=>{for(var t in e)l(r,t,{get:e[t],enumerable:!0})},_=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of p(e))!w.call(r,s)&&s!==t&&l(r,s,{get:()=>e[s],enumerable:!(n=m(e,s))||n.enumerable});return r};var g=r=>_(l({},"__esModule",{value:!0}),r);var f={};v(f,{DB:()=>u});var u,d=b(()=>{u=class{constructor(e,t,n){return this.db_name=e||"__adorn__",typeof t=="object"?(this.version=1,this.schema=t):(this.version=t||1,this.schema=n),this.table_name="__adorn__",Object.assign(this.scope.bind(this),this)}scope(e){let t=Object.create(this);return t.table_name=e,t}open(e){return new Promise((t,n)=>{let s=self.indexedDB.open(this.db_name,this.version);s.onsuccess=c=>{t(c.target.result)},s.onerror=n,s.onupgradeneeded=c=>{let o=c.target.result;for(let a in this.schema)o.objectStoreNames.contains(a)||o.createObjectStore(a,this.schema[a])}}).then(t=>t.transaction([this.table_name],e).objectStore(this.table_name))}get(e){return new Promise((t,n)=>{this.open().then(s=>{let c=s.get(e);c.onsuccess=o=>{t(o.target.result)},c.onerror=o=>{n(o.target.result)}})})}all(){return new Promise((e,t)=>{this.open().then(n=>{let s=n.openCursor();s.onerror=o=>{t(o.target.result)};let c=[];s.onsuccess=o=>{let a=o.target.result;a?(c.push(a.value),a.continue()):e(c)}})})}put(e,t){return new Promise((n,s)=>{typeof e=="object"?t=e:t.key=e,this.open("readwrite").then(c=>{let o=c.put(t);o.onsuccess=a=>{n(a.target.result)},o.onerror=a=>{s(a.target.result)}}).catch(s)})}}});var h="adorn_sw";var q=(d(),g(f)),E=new q("adorn_sw",1,{falloverStore:{autoIncrement:!0}}),i=E("falloverStore");self.addEventListener("install",r=>{r.waitUntil(caches.open(h).then(()=>{}))});self.addEventListener("fetch",r=>{{let n=new URL(r.request.url);if(self.location.host!==n.host)return!1}let e=r.request,t;r.respondWith((async()=>{let n=caches.match(e).then(o=>(o&&(t=t||"cache wins"),o)),s=fetch(e).then(o=>(o&&(t=t||"network wins"),o)),c=S([n,s]);return c.then(()=>{console.log(t,e.url)}),s.then(j.bind(null,e)),c.catch(P.bind(null,e))})())});function S(r){return new Promise((e,t)=>{r=r.map(n=>Promise.resolve(n).then(y)),r.forEach(n=>n.then(e)),r.reduce((n,s)=>n.catch(()=>s)).catch(()=>t(Error("All failed")))})}function y(r){if(!r)throw new Error("not found");return r}function j(r,e){if(!e||e.status!==200||e.type!=="basic")return e;let t=e.clone();return caches.open(h).then(n=>{n.put(r,t)}),e}async function P(r){let t=(await i.all()).filter(n=>(!n.mode||n.mode===r.mode)&&(!n.url||r.url.match(n.url)))[0];if(t)return caches.match(new Request(t.fallover))}self.addEventListener("message",r=>{let e=r.data;caches.open(h).then(t=>{switch(e.type){case"fallover":{i.all().then(n=>{let s=n.filter(o=>o.mode===e.mode&&o.url===e.url)[0];if(s&&s.fallover===e.fallover)return;let c=new Request(e.fallover,{mode:"no-cors"});fetch(c).then(o=>(s?s.fallover=e.fallover:i.put(e),t.put(e.fallover,o)))});break}case"add":{let n=new Request(e.url,{mode:"no-cors"});return fetch(n).then(s=>t.put(e.url,s))}}})});})();
//# sourceMappingURL=adorn_sw.js.map
